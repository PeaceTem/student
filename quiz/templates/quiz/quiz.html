{% load static %}


{% block quizCss %}
<link rel="stylesheet" href="{% static 'quiz/css/quizzes_list.css' %}">
{% endblock quizCss %}
{% include 'navbar.html' %}

{% include 'messages.html' %}

<input type="hidden" name="nav" id="navActive" value="{{nav}}">
<div class="head-link">
    <a href="{% url 'quiz:quizzes' %}" id="all">All</a>
    <a href="{% url 'quiz:following-quizzes' %}" id="following">Followings</a>
    <a href="{% url 'quiz:my-quizzes' %}" id="my">My quiz</a>    
</div>
{% include 'search.html' %}

<div class="card-container infinite-container">
    {% for quiz in page_obj %}
        <div class='card infinite-item'>
            <div class="contentBx">
                <a href="{% url 'profile:profile' quiz.user.username %}" class="username">
                    <img src="https://picsum.photos/20" alt="">
                    @{{quiz.user.username}}
                </a>
                <div class="categories">
                    {% for category in quiz.categories.all %}
                        <span class="category">{{category.title}}</span>
                    {% endfor %}
                </div>
                <div id="outputDate" class="outputDate"></div>
                <!-- use aspect-ratio for the background of the title. -->
                <div class="title-block">
                    <a class="link" href="{% url 'quiz:quiz-detail' quiz.id profile.code %}">
                        <img src="https://picsum.photos/300" alt="">
                        <div class="title">
                            {{quiz.title|capfirst}}
                        </div>
                    </a>
                    
                
                </div>
                <div class="desc">{{quiz.description|truncatewords:50}}</div>
                <div class="creator">
                <div class="create" style="display:none;">{{quiz.user|capfirst}}</div>
                <div class="date"  style="display:none;">{{quiz.date|date:"Y-M-d"}} {{quiz.date|time:"H:i"}}</div> 
                </div>
                <div class="inline inlineOne">
                    
                    <div class="questionLength">
                        {{quiz.questionLength}} questions
                    </div>
                   
                    <div class="duration">
                        {{quiz.duration}} min
                    </div>

                </div>
                <div class="inline inlineTwo">
                    <div class="attempt">
                        {% if quiz.attempts < 2 %}
                            {{quiz.attempts}} attempt
                        {% else %}
                            {{quiz.attempts}} attempts
                        {% endif %}
                    </div>
                    <div class="average">
                        {{quiz.average_score}}%
                    </div>
                    <span>{{quiz.likes.all.count}} likes</span>

                </div>
                       <div class="linkBx">
                        <div id="likes">
                            <form action="{% url 'quiz:post-like' %}" method="post">
                                {% csrf_token %}
                                <input type="hidden" name="quiz_id" value="{{quiz.id}}">
                                {% if not request.user in quiz.likes.all %}
                                    <button type="submit">like</button>
                                {% else %}
                                    <button type="submit">unlike</button>
                                {% endif %}
                            </form>
                        </div>
                        <div id="take-quiz">
                            <a class="link" href="{% url 'quiz:take-quiz' quiz.id %}"><i class="fa fa-reply" aria-hidden="true"></i><div>Take Quiz</div></a>
                        </div>
                       </div>
            </div>
        </div>
    {% endfor %}
</div>

<div class="d-flex d-none position-fixed" style="color:white;bottom:2vh;left:46vw">
    <button class="btn btn-danger loading">
        <span style="color:white;" class="spinner-border spinner-border-sm"></span>
    </button>
</div>

<div class="row d-none">
    <div class="col-12">
        {% if page_obj.has_next %}
        <a class="infinite-more-link" href="?page={{ page_obj.next_page_number }}">next</a>
        {% endif %}
        </span>
    </div>
</div>
<script>
    
</script>

<script src="/static/js/navbar.js" type="text/javascript"></script>
<script src="/static/quiz/js/quizzes_list.js"></script>
<script src="{% static 'js/jquery.waypoints.min.js' %}"></script>
<script src="{% static 'js/infinite.min.js' %}"></script>
<script>
    var infinite = new Waypoint.Infinite({
        element: $('.infinite-container')[0],

        offset: 'bottom-in-view',

        onBeforePageLoad: function () {
            $('.loading').show();
        },
        onAfterPageLoad: function () {
            $('.loading').hide();
        }

    });
</script>
