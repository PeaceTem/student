{% extends 'quiz/base.html' %}
{% load static %}
{% load social_share %}

{% block quizTitle %}
Quiz Detail
{% endblock quizTitle %}

{% block content %}

{% block quizCss %}
<link rel="stylesheet" href="{% static 'quiz/css/quizdetail.css' %}">
{% endblock quizCss %}
{% include 'messages.html' %}

<div class="detail">
    
        <div>
            <a href="{% url 'profile:profile' quiz.user.username %}">
                <div>
                    @{{quiz.user.username}}
                </div>
            </a>
        </div>
        <div class="categories">
                Categories:
                {% for category in quiz.categories.all %}
                    <span class="category">{{category.title}}</span>
                {% endfor %}
        </div>
        <div >Title: {{quiz.title|capfirst}}</div>
        <div >{{quiz.description | safe}}</div> 
        <div >created by {{quiz.user|capfirst}}</div>
        <div >It was created on {{quiz.date|date:"Y-M-d"}} {{quiz.date|time:"H:i"}}</div> 
        <div >
                    {% if quiz.attempts < 2 %}
                        {{quiz.attempts}} attempt
                    {% else %}
                        {{quiz.attempts}} attempts
                    {% endif %}
        </div>
        <div class="questionLength">
            {% if quiz.questionLength < 2 %}
                {{quiz.questionLength}} question
            {% else %}
                {{quiz.questionLength}} questions
            {% endif %}
                    
        </div>
        <div class="average">
                    {{quiz.average_score}}%
        </div>
        <div class="duration">
                    {{quiz.duration_in_minutes}} min
        </div>

        <div class="linkBx">
            <!-- assign this value to a variable -->
            {% if quiz.likes.all.count < 2 %}
            {{quiz.likes.all.count}} like
                    {% else %}
                    {{quiz.likes.all.count}} likes
                {% endif %}
        </div>
        <div>
            <a href="{% url 'quiz:take-quiz' quiz.id %}">
                <p>
                    Take Quiz
                </p>
            </a>
        </div>
        {% if quiz.user == user %}
        <div>
            <a href="{% url 'quiz:quiz-update' quiz.id %}"><p>Edit Quiz</p></a>
        </div>
        <div>
            <a href="{% url 'quiz:delete-quiz' quiz.id %}"><p>Ã— Delete Quiz</p></a>
        </div>
        <div>
            <a href="{% url 'quiz:new-question' quiz.id %}"><p>+ Add More Questions</p></a>
        </div>
        {% endif %}
<div class="copy-link-container">
    <div class="label">
        Copy link
    </div>
    <div class="copy-text">
        <input id="copy-link" type="text" class="text" value="">
        <button onclick="copyFunction()">Copy</button>
    </div>
</div>

<div class="social-share">
    Refer To Earn More Coins (50 coins per click)
{% post_to_facebook  object_or_url 'Post to Facebook' %}
{% post_to_twitter "Take A Quiz: {{quiz.title}}" object_or_url "Post to Twitter" %}
{% post_to_linkedin  object_or_url "Post to" %}
{% send_email "ToTheX Quiz" "Take A Quiz: {{quiz.title}}" object_or_url "Share via email" %}
{% post_to_reddit "Take A Quiz: {{quiz.title}}" object_or_url %}
{% post_to_telegram "Take A Quiz: {{quiz.title}}" object_or_url %}
{% post_to_whatsapp object_or_url "Share via WhatsApp" %}
{% save_to_pinterest object_or_url %}
</div>

<div>
    <a href="{% url 'quiz:quizzes' %}">Go back to home page</a>
</div>


<div>
    <img src="{{postAd.picture.url}}">
</div>

<div>
    {{postAd.description}}
</div>

<div>
    <a href="{{postAd.link}}" target="_blank">Visit Site</a>
</div>
{% if quiz.user == user %}
<div>
    {% for question in quiz.fourChoicesQuestions.all %}
        <div class="quizItem">
            {{question.question_text|truncatechars:20}}
        </div>

        <div class="private-links">
            <a href="{% url 'quiz:delete-question' quiz.id 'fourChoices' question.id %}">Delete</a>
        </div>
    {% endfor %}
    {% for question in quiz.trueOrFalseQuestions.all %}
    <div class="questions">
        <div class="quizItem">
            {{question.question_text|truncatechars:20}}
        </div>

        <div class="private-links">
            <a id="deleteButton" data-url="{% url 'quiz:delete-question' quiz.id 'trueOrFalse' question.id %}" href="{% url 'quiz:delete-question' quiz.id 'trueOrFalse' question.id %}">Delete</a>
        </div>
    </div>
        
    {% endfor %}
</div>
{% endif %}
</div>
<script src="{% static 'js/jquery.js' %}"></script>
<script>
    const deleteButton = $('#deleteButton');
    $(document).on('click', '#deleteButton', function(e){
        alert('JQuery is working!');
        e.preventDefault();
        alert($('#deleteButton').data('url'));

        $.ajax({
            type: 'GET',
            url : $('#deleteButton').data('url'),
            data : {
            },
            success : function(response){
                alert('It works');
                document.querySelector('#deleteButton').parentNode.parentNode.style.display = 'none';

                console.log(response)
                

            },
            error : function(){
                alert('It falis silently!')
            }

        });
    });
        

    console.log(deleteButton);
    function copyFunction(){
    let copyText = document.getElementById('copy-link');
    copyText.select();
    copyText.setSelectionRange(0,99999);
    // document.execCommand("copy")
    navigator.clipboard.writeText(copyText.value)
    alert("Copied the text: " + copyText.value)
}

const share = document.querySelector('.social-share');
console.log(share);
</script>

<script src="{% static 'quiz/js/copy.js' %}" type="text/javascript"></script>
{% endblock content %}
