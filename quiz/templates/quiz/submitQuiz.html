

{% extends 'quiz/base.html' %}

{% load static %}
{% load social_share %}
{% block quizTitle %}
Quiz Submit
{% endblock quizTitle %}

{% block content %}

{% block quizCss %}
<link rel="stylesheet" href="{% static 'quiz/css/submitQuiz.css' %}">
{% endblock quizCss %}





<div class="question-card-container">
    <div>
        <a href="{% url 'quiz:quizzes' %}">Go back home</a>

    </div>

    <div>
        <a href="{% url 'profile:profile' quiz.user.username %}">
            @{{quiz.user.username}}
        </a>
    </div>
{% include 'messages.html'%}

    <div>
        {{attempt_report}}
        <br>
        You scored: {{user_score}} out of {{total_score}}
        <br>
        Quiz's average score: {{avgScore}}%
        <br>
        Your Average Score: {{user_avg_score}}%
        <br>
        {{timeTaken}}
    </div>
</div>


<div class="question-card-container download-quiz">
        You don't see the solutions to questions you didn't answer!
        
        {% for question, answer in questionsList %}
        <div class="question-box">
        <ol>

            {% if question.form == 'fourChoicesQuestion' %}
        <li class="question">


            <div>
                    {{question.question_text|safe}} <br>
                    <div class="points">
                        {% if question.points < 2 %}
                        {{question.points}} point
                    {% else %}
                        {{question.points}} points
                    {% endif %}
                    </div>
                    <ol style="list-style:upper-alpha;">
                        <li>
                            <div class="answer">
                                {{question.answer1}}
                            </div>
                        </li>
                       
                        <li>
                            <div class="answer">
                                {{question.answer2}}
            
                            </div>
                        </li>
                     
                        <li>
                            <div class="answer">
                                {{question.answer3}}
               
                            </div>
                        </li>
   
                        <li>
                            <div class="answer">
                                {{question.answer4}}
             
                            </div>
                        </li>
                        <div>
                            Your Answer:
                            {{answer}}
                        </div>
                       
                        
                        <div class="correct-answer">
                            Correct Answer:
                        {% if question.correct == 'answer1' %}
                            {{question.answer1}}
                        {% elif question.correct == 'answer2' %}
                            {{question.answer2}}
                        {% elif question.correct == 'answer3' %}
                            {{question.answer3}}
                        {% elif question.correct == 'answer4' %}
                            {{question.answer4}}
                        {% endif %}
                        </div>
                        
                        
                    </ol>
                    <div class="solution">
                        Solution: {{question.solution}}
                    </div>
               
            </div>
        </li>
            {% elif question.form == 'trueOrFalseQuestion' %}
            <li class="question">


                <div>
                        {{question.question_text|escape}} <br>
                        <div class="points">
                            {% if question.points < 2 %}
                            {{question.points}} point
                        {% else %}
                            {{question.points}} points
                        {% endif %}
                        </div>
                        <ol style="list-style:upper-alpha;">
                            <li>
                                <div class="answer">
                                    {{question.answer1}}
                                </div>
                            </li>
                           
                            <li>
                                <div class="answer">
                                    {{question.answer2}}
                                    </div>
                            </li>
                            <div>
                                Your Answer:
                                {{answer}}
                            </div>
                           
                            <div class="correct-answer">
                                Correct Answer:
                                {% if question.correct == 'True' %}
                                    True
                                {% elif question.correct == 'False' %}
                                    False
                                {% endif %}
                            </div>
                         
                        
                        </ol>
                        <div class="solution">
                            Solution: {{question.solution}}
                        </div>
                   
                </div>
            </li>

            {% endif %}
            </ol>
        </div>
        {% endfor %}
</div>
<div class="question-card-container">
    <div class="linkBx">
        <div id="likes">
         
            <form data-quiz="{{quiz.id}}" data-url="{% url 'quiz:post-like' %}" data-id="likeForm{{quiz.id}}" id="likeForm{{quiz.id}}" method="post" class="likeForm">
                {% csrf_token %}
                <input type="hidden" name="quiz_id" value="{{quiz.id}}">
                {% if not request.user in quiz.likes.all %}
                    <button id="like{{quiz.id}}" type="submit">
                        <div style="color:#fff;" id="likeButton{{quiz.id}}" >like</div>
                    </button>
                {% else %}
                    <button id="like{{quiz.id}}" type="submit">
                        <div  style="color:#fff;" id="likeButton{{quiz.id}}" >unlike</div>
                    </button>
                {% endif %}
            </form>
        </div>
    </div>
    <div style="display:none; max-width: 500px;" class="result">
    
    </div>
    {% if not request.user in quiz.solution_validators.all %}
    <div>
        <form method="get" id="solutionQualityForm" data-url="{% url 'quiz:solution-quality' quiz.id %}">
            <div>Are the solutions helpful?</div>
        <input type="radio" id="yes"  name="quality" value="Yes">
        <label for="yes">Yes</label>
        <input type="radio" id="no"  name="quality" value="No">
        <label for="no">No</label>
        <br>
        <input type="submit" value="Submit">
    </form>
    </div>
    {% endif %}
    <div>
        <a href="" class="a">Download the Image</a>
    </div>
<div>
    <a href="{% url 'quiz:quiz-pdf' quiz.id %}">
        Download the Pdf
    </a>
</div>

<div>
    <img src="{{postAd.picture.url}}">
</div>

<div>
    {{postAd.description}}
</div>

<div>
    <a class="postAd" onclick="clickFunction()" data-url="{% url 'ads:post-click' postAd.id %}" href="{{postAd.link}}" target="_blank">Visit Site</a>
</div>


<div class="social-share">
    Refer To Earn More Coins (20 coins per click)
{% post_to_facebook  object_or_url 'Post to Facebook' %}
{% post_to_twitter "Take A Quiz: {{quiz.title}}" object_or_url "Post to Twitter" %}
{% post_to_linkedin  object_or_url "Post to" %}
{% send_email "ToTheX Quiz" "Take A Quiz: {{quiz.title}}" object_or_url "Share via email" %}
{% post_to_reddit "Take A Quiz: {{quiz.title}}" object_or_url %}
{% post_to_telegram "Take A Quiz: {{quiz.title}}" object_or_url %}
{% post_to_whatsapp object_or_url "Share via WhatsApp" %}
{% save_to_pinterest object_or_url %}
</div>

</div>

<script src="{% static 'question/html2canvas.js' %}"></script>
<script src="{% static 'js/jquery.js' %}"></script>
<script>

    let elm = document.querySelector('.download-quiz');
    elm.prepend("");
    html2canvas(elm).then(function(canvas){
        document.querySelector('.result').append(canvas);
        let cvs = document.querySelector('canvas');
        let a = document.querySelector('.a');
        a.href = cvs.toDataURL();
        a.download = 'tothex-{{quiz.quiz.title}}.png'
    })




    function clickFunction(){
        $.ajax({
            // change this to post
            type: 'GET', 
            url : $('a.postAd').data('url'),
            data : {
            },
            success : function(response){
                alert('link clicked!')
                

            },
            error : function(){
                alert('It falis silently!')
            }

        });

    }

function ActivateForm(){
    const solution = document.getElementById('solutionQualityForm');
    solution.submit();
}


    $(document).on('submit', '#solutionQualityForm', function(e){
    e.preventDefault();
        const object = $('#solutionQualityForm');
        const dataList = object.serialize()
        $.ajax({
            // change this to post
            type: 'GET', 
            // serialize the data
            url : $('#solutionQualityForm').data('url'),
            data : dataList,
            success : function(response){
                $('#solutionQualityForm').parent().hide(1000);
                

            },
            error : function(){
            }

        });
        });




$('.likeForm').submit(function(e){
e.preventDefault();
const serializeData = $(this).serialize()
const quiz_id = $(this).data('quiz')
// alert('Still working!')
// alert(serializeData)
$.ajax({
    type: 'POST',
    url : $(this).data('url'),
    data : serializeData,
    success : function(response){
        // alert('It works');
        // document.querySelector('#deleteButton').parentNode.parentNode.style.display = 'none';
        // console.log(id);
        // console.log(response)
        
        if (response == 'liked'){
            // console.log($(`#likeButton${id}`));
            $(`#likeButton${quiz_id}`).text('unlike');
        }else if (response == 'unliked'){
            // console.log($(`#unlikeButton${id}`));
            $(`#likeButton${quiz_id}`).text('like');
        }
        

    },
    error : function(){
        alert('It falis silently!')
    }

});
})

</script>
{% endblock content %}